<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management - E-Learning Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>

<body class="bg-[#f4f6f9]">

    <body class="bg-[#f4f6f9]">

        <%- include('../partials/header.ejs') %>

            <div class="flex">
                <%- include('../partials/sidebar.ejs') %>

                    <main class="flex-1 p-6 space-y-6">

                        <!-- COURSE MANAGEMENT CONTENT -->
                        <main class="flex-1 p-6 space-y-6" id="courseManagementPage">

                            <!-- ================= STATS ================= -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div
                                    class="bg-white rounded-xl shadow-sm p-4 hover:-translate-y-1 hover:shadow-md transition-all">
                                    <h6 class="text-gray-600 text-sm">Total Courses</h6>
                                    <div class="text-3xl font-bold mt-2">12</div>
                                    <div class="text-xs text-green-600 mt-1">‚Üë 2 new this month</div>
                                </div>
                                <div
                                    class="bg-white rounded-xl shadow-sm p-4 hover:-translate-y-1 hover:shadow-md transition-all">
                                    <h6 class="text-gray-600 text-sm">Active Courses</h6>
                                    <div class="text-3xl font-bold mt-2">8</div>
                                    <div class="text-xs text-green-600 mt-1">‚Üë 66% active rate</div>
                                </div>
                                <div
                                    class="bg-white rounded-xl shadow-sm p-4 hover:-translate-y-1 hover:shadow-md transition-all">
                                    <h6 class="text-gray-600 text-sm">Total Enrollments</h6>
                                    <div class="text-3xl font-bold mt-2">87</div>
                                    <div class="text-xs text-green-600 mt-1">‚Üë 12% from last month</div>
                                </div>
                                <div
                                    class="bg-white rounded-xl shadow-sm p-4 hover:-translate-y-1 hover:shadow-md transition-all">
                                    <h6 class="text-gray-600 text-sm">Revenue This Month</h6>
                                    <div class="text-3xl font-bold mt-2">‚Çπ1.2L</div>
                                    <div class="text-xs text-green-600 mt-1">‚Üë 18% growth</div>
                                </div>
                            </div>

                            <!-- ================= CHARTS ================= -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-white rounded-xl shadow-sm p-4">
                                    <h5 class="font-semibold text-lg">Enrollment Trends</h5>
                                    <p class="text-xs text-gray-500 mt-1">Monthly enrollment statistics</p>
                                    <div class="mt-3">
                                        <canvas id="enrollmentChart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-white rounded-xl shadow-sm p-4">
                                    <h5 class="font-semibold text-lg">Top 5 Popular Courses</h5>
                                    <p class="text-xs text-gray-500 mt-1">By enrollment count</p>
                                    <div class="mt-3">
                                        <canvas id="popularCoursesChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- ================= FEATURED COURSES HEADER ================= -->
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold">Featured Courses</h2>
                                <div class="flex gap-3">
                                    <button class="px-5 py-2 bg-green-600 text-white rounded-lg"
                                        onclick="showAddCategoryPage()">
                                        + Add Category</button>
                                    <button
                                        class="px-5 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:opacity-90 transition"
                                        onclick="showAddCoursePage()">+ Add New Course</button>
                                    <button
                                        class="px-5 py-2 border border-blue-600 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-600 hover:text-white transition"
                                        onclick="showAllCourses()">View All Courses</button>
                                </div>
                            </div>

                            <!-- ================= COURSE CARDS ================= -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="topCourses">
                                <% courses.slice(0,4).forEach(course=> { %>

                                    <div
                                        class="bg-white rounded-xl overflow-hidden shadow-sm hover:-translate-y-2 hover:shadow-lg transition-all">

                                        <div class="w-full h-40 overflow-hidden">
                                            <img src="<%= course.thumbnail %>" alt="<%= course.title %>"
                                                class="w-full h-full object-cover"
                                                onerror="this.src='/images/course-placeholder.png'" />
                                        </div>


                                        <div class="p-4">
                                            <h3 class="text-lg font-bold mb-3">
                                                <%= course.title %>
                                            </h3>

                                            <div class="space-y-2 mb-4 text-sm text-gray-500">
                                                <p>‚è±Ô∏è Duration: <%= course.duration %>
                                                </p>
                                                <% if (course.instructor && course.instructor.name) { %>
                                                    <p class="text-sm text-gray-500">
                                                        üë®‚Äçüè´ <%= course.instructor.name %>
                                                    </p>
                                                    <% } %>


                                                        <% const percent=course.intakeLimit> 0
                                                            ? Math.min(
                                                            Math.round((course.enrolledCount / course.intakeLimit) *
                                                            100),
                                                            100
                                                            )
                                                            : 0;
                                                            %>

                                                            <div class="w-full h-2 bg-gray-200 rounded mt-2">
                                                                <div class="h-full bg-blue-600 rounded transition-all"
                                                                    style="width: <%= percent %>%">
                                                                </div>
                                                            </div>

                                            </div>

                                            <div class="flex justify-between items-center pt-4 border-t">
                                                <span class="text-xl font-bold text-blue-600">
                                                    ‚Çπ<%= course.fee %>
                                                </span>

                                                <span class="px-3 py-1 rounded-full text-xs font-semibold
                        <%= course.status === 'active'
                        ? 'bg-green-100 text-green-800'
                        : course.status === 'full'
                        ? 'bg-yellow-100 text-yellow-800'
                        : 'bg-red-100 text-red-800' %>">
                                                    <%= course.status %>
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <% }) %>
                            </div>

                            <!-- ================= ALL COURSES TABLE ================= -->
                            <div class="bg-white rounded-xl shadow-sm overflow-hidden hidden" id="allCoursesTable">
                                <div class="px-6 py-5 border-b flex justify-between items-center">
                                    <h2 class="text-xl font-bold">All Courses</h2>
                                    <button
                                        class="px-5 py-2 border border-blue-600 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-600 hover:text-white transition"
                                        onclick="hideAllCourses()">‚Üê Back to Cards</button>
                                </div>

                                <!-- Search and Filter Bar -->
                                <div class="px-6 pb-5 pt-4">
                                    <div class="flex gap-3 items-center flex-wrap">
                                        <input type="text" id="courseSearch" placeholder="üîç Search courses by name..."
                                            onkeyup="filterCourses()"
                                            class="flex-1 min-w-64 px-4 py-2 border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-600 transition-colors">
                                        <select
                                            class="px-4 py-2 border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-600 bg-white cursor-pointer min-w-40"
                                            id="statusFilter" onchange="filterCourses()">
                                            <option value="all">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                            <option value="full">Full</option>
                                        </select>
                                        <select
                                            class="px-4 py-2 border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-600 bg-white cursor-pointer min-w-40"
                                            id="sortFilter" onchange="filterCourses()">
                                            <option value="recent">Recent First</option>
                                            <option value="trending">Trending</option>
                                            <option value="popular">Most Popular</option>
                                            <option value="price-low">Price: Low to High</option>
                                            <option value="price-high">Price: High to Low</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Course Name</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Duration</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Fee</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Intake Limit</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Enrollments</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Status</th>
                                                <th
                                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                                    Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="courseTableBody">
                                            <% courses.forEach(course=> { %>
                                                <tr class="hover:bg-gray-50 border-t" data-status="<%= course.status %>"
                                                    data-enrollments="<%= course.enrolledCount %>"
                                                    data-fee="<%= course.fee %>">

                                                    <td class="px-6 py-5 text-sm font-semibold">
                                                        <%= course.title %>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        <%= course.duration %>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        ‚Çπ<%= course.fee %>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        <%= course.intakeLimit %>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        <%= course.enrolledCount %>/<%= course.intakeLimit %>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        <span class="px-3 py-1 rounded-full text-xs font-semibold
                                    <%= course.status === 'active'
                                        ? 'bg-green-100 text-green-800'
                                        : course.status === 'full'
                                        ? 'bg-yellow-100 text-yellow-800'
                                        : 'bg-red-100 text-red-800' %>">
                                                            <%= course.status %>
                                                        </span>
                                                    </td>

                                                    <td class="px-6 py-5 text-sm">
                                                        <div class="flex gap-2">
                                                            <button class="w-8 h-8 bg-blue-50 rounded"
                                                                onclick='openEditCourse(<%- JSON.stringify(course) %>)'>
                                                                ‚úèÔ∏è
                                                            </button>

                                                            <button class="w-8 h-8 bg-purple-50 rounded"
                                                                title="Manage Lectures"
                                                                onclick="openLectureManager('<%= course._id %>', '<%= course.title %>')">
                                                                üìö
                                                            </button>
                                                            <button class="w-8 h-8 bg-green-50 rounded"
                                                                title="Preview Course"
                                                                onclick="previewCourse('<%= course._id %>')">
                                                                üëÅÔ∏è
                                                            </button>

                                                            <button class="w-8 h-8 bg-red-50 rounded"
                                                                title="Delete Course"
                                                                onclick="deleteCourse('<%= course._id %>')">
                                                                üóëÔ∏è
                                                            </button>

                                                        </div>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </main>

                        <!-- ================= ADD COURSE PAGE ================= -->
                        <main class="flex-1 p-6 hidden" id="addCoursePage">
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h2 class="text-2xl font-bold mb-1">Add New Course</h2>
                                <p class="text-gray-500 text-sm mb-6">
                                    Dashboard / Course Management / Add Course
                                </p>

                                <form action="/courses/add" method="POST" class="space-y-6"
                                    enctype="multipart/form-data">

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                        <!-- Course Title -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Course Title *</label>
                                            <input type="text" name="title" required
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Full Stack Web Development">
                                        </div>

                                        <!-- Course Fee -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Course Fee (‚Çπ) *</label>
                                            <input type="number" name="fee" required
                                                class="w-full px-4 py-2 border rounded-lg">
                                        </div>

                                        <!-- Short Description -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Short Description *</label>
                                            <textarea name="shortDescription" required
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Brief summary shown on course card"></textarea>
                                        </div>

                                        <!-- Full Description -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Full Description</label>
                                            <textarea name="fullDescription" class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Detailed course description"></textarea>
                                        </div>

                                        <!-- ================= SYLLABUS ================= -->
                                        <div class="md:col-span-2">
                                            <h3 class="text-lg font-semibold mt-4">Syllabus</h3>
                                        </div>

                                        <!-- Syllabus Overview -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Syllabus Overview</label>
                                            <textarea name="syllabusOverview" class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Brief overview of what this course covers"></textarea>
                                        </div>

                                        <!-- Syllabus Topics -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Syllabus Topics</label>
                                            <input type="text" name="syllabusTopics"
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Introduction, Basics, Advanced Topics, Projects">
                                            <p class="text-xs text-gray-500 mt-1">
                                                Enter topics separated by commas
                                            </p>
                                        </div>

                                        <!-- Syllabus PDF -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Syllabus PDF</label>
                                            <input type="file" name="syllabusFile" accept=".pdf"
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                        </div>

                                        <!-- Thumbnail URL -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Thumbnail URL *</label>
                                            <input type="text" name="thumbnail" required
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="https://image-link.jpg">
                                        </div>

                                        <!-- Intro Video -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Intro Video URL</label>
                                            <input type="text" name="introVideo"
                                                class="w-full px-4 py-2 border rounded-lg">
                                        </div>

                                        <!-- Duration -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Duration *</label>
                                            <select name="duration" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="">Select duration</option>
                                                <option value="1 Month">1 Month</option>
                                                <option value="2 Months">2 Months</option>
                                                <option value="3 Months">3 Months</option>
                                                <option value="6 Months">6 Months</option>
                                            </select>
                                        </div>

                                        <!-- Level -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Level *</label>
                                            <select name="level" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="">Select level</option>
                                                <option value="beginner">Beginner</option>
                                                <option value="intermediate">Intermediate</option>
                                                <option value="advanced">Advanced</option>
                                            </select>
                                        </div>

                                        <!-- Languages -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Languages</label>
                                            <input type="text" name="languages"
                                                class="w-full px-4 py-2 border rounded-lg" placeholder="English, Hindi">
                                        </div>

                                        <!-- Certificate -->
                                        <div class="flex items-center gap-2 mt-7">
                                            <input type="checkbox" name="certificate" value="true">
                                            <label class="text-sm font-medium">Certificate Available</label>
                                        </div>

                                        <!-- Intake Limit -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Intake Limit</label>
                                            <input type="number" name="intakeLimit" value="10"
                                                class="w-full px-4 py-2 border rounded-lg">
                                        </div>

                                        <!-- Category (ObjectId expected) -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Category *</label>
                                            <select name="category" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="">Select category</option>
                                                <% categories.forEach(cat=> { %>
                                                    <option value="<%= cat._id %>">
                                                        <%= cat.domain %> - <%= cat.subDomain %>
                                                    </option>
                                                    <% }) %>
                                            </select>
                                        </div>

                                        <!-- Status -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Status</label>
                                            <select name="status" class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="active">Active</option>
                                                <option value="inactive">Inactive</option>
                                            </select>
                                        </div>

                                        <!-- Tags -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Tags</label>
                                            <input type="text" name="tags" class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="mern, backend, node">
                                        </div>

                                        <!-- Prerequisites -->
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Prerequisites</label>
                                            <input type="text" name="prerequisites"
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Basic HTML, JavaScript">
                                        </div>

                                    </div>

                                    <!-- Actions -->
                                    <div class="flex gap-3 pt-6 border-t">
                                        <button type="button" onclick="cancelAddCourse()"
                                            class="px-6 py-2 border rounded-lg">Cancel</button>
                                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">
                                            Save Course
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </main>

                        <!-- ================= ADD CATEGORY PAGE ================= -->
                        <main class="flex-1 p-6 hidden" id="addCategoryPage">
                            <div class="bg-white rounded-xl shadow-sm p-6 max-w-3xl">

                                <h2 class="text-2xl font-bold mb-1">Add New Category</h2>
                                <p class="text-gray-500 text-sm mb-6">
                                    Dashboard / Course Management / Add Category
                                </p>

                                <form action="/admin/categories/add" method="POST" class="space-y-6">

                                    <div>
                                        <label class="block text-sm font-medium mb-2">Domain *</label>
                                        <input type="text" name="domain" required
                                            class="w-full px-4 py-2 border rounded-lg" placeholder="IT / NON-IT">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">Sub Domain *</label>
                                        <input type="text" name="subDomain" required
                                            class="w-full px-4 py-2 border rounded-lg"
                                            placeholder="Programming / Web Development">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">Tagline</label>
                                        <input type="text" name="tagline" class="w-full px-4 py-2 border rounded-lg"
                                            placeholder="Learn industry-ready skills">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">Description</label>
                                        <textarea name="description" class="w-full px-4 py-2 border rounded-lg"
                                            placeholder="Shown to users"></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">Status</label>
                                        <select name="status" class="w-full px-4 py-2 border rounded-lg bg-white">
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>

                                    <div class="flex gap-3 pt-4 border-t">
                                        <button type="button" onclick="cancelAddCategory()"
                                            class="px-6 py-2 border rounded-lg">
                                            Cancel
                                        </button>

                                        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg">
                                            Save Category
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </main>


                        <!-- ================= EDIT COURSE PAGE ================= -->
                        <main class="flex-1 p-6 hidden" id="editCoursePage">
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <div>
                                        <h2 class="text-2xl font-bold">Edit Course</h2>
                                        <p class="text-gray-500 text-sm mt-1">Dashboard / Course Management / Edit
                                            Course</p>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div
                                            class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">
                                            AD</div>
                                        <span class="text-sm font-medium">Admin User</span>
                                    </div>
                                </div>
                                <form id="editCourseForm" method="POST" class="space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                        <!-- Course Title -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Course Title *</label>
                                            <input type="text" id="editCourseName" name="title" required
                                                class="w-full px-4 py-2 border rounded-lg" />
                                        </div>

                                        <!-- Course Fee -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Course Fee (‚Çπ) *</label>
                                            <input type="number" id="editCourseFee" name="fee" required
                                                class="w-full px-4 py-2 border rounded-lg" />
                                        </div>

                                        <!-- Duration -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Duration *</label>
                                            <select name="duration" id="editCourseDuration" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="1 Month">1 Month</option>
                                                <option value="2 Months">2 Months</option>
                                                <option value="3 Months">3 Months</option>
                                                <option value="6 Months">6 Months</option>
                                            </select>
                                        </div>

                                        <!-- Intake Limit -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Intake Limit *</label>
                                            <input type="number" name="intakeLimit" id="editCourseIntake" required
                                                class="w-full px-4 py-2 border rounded-lg" />
                                        </div>

                                        <!-- Instructor Details -->
                                        <div class="md:col-span-2">
                                            <h3 class="text-lg font-semibold mb-2">Instructor</h3>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium mb-2">Instructor Name *</label>
                                            <input type="text" name="instructor[name]" required
                                                class="w-full px-4 py-2 border rounded-lg" placeholder="John Doe">
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium mb-2">Designation</label>
                                            <input type="text" name="instructor[designation]"
                                                class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="Senior Software Engineer">
                                        </div>

                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2">Instructor Bio</label>
                                            <textarea name="instructor[bio]" class="w-full px-4 py-2 border rounded-lg"
                                                placeholder="10+ years experience in industry..."></textarea>
                                        </div>


                                        <!-- Status -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Status *</label>
                                            <select id="editCourseStatus" name="status" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <option value="active">Active</option>
                                                <option value="inactive">Inactive</option>
                                            </select>
                                        </div>

                                        <!-- Category -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Category *</label>
                                            <select id="editCourseCategory" name="category" required
                                                class="w-full px-4 py-2 border rounded-lg bg-white">
                                                <% categories.forEach(cat=> { %>
                                                    <option value="<%= cat._id %>">
                                                        <%= cat.domain %> - <%= cat.subDomain %>
                                                    </option>
                                                    <% }) %>
                                            </select>
                                        </div>

                                    </div>

                                    <!-- Actions -->
                                    <div class="flex gap-3 pt-6 border-t">
                                        <button type="button" onclick="cancelEditCourse()"
                                            class="px-6 py-2 border rounded-lg">
                                            Cancel
                                        </button>
                                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">
                                            Update Course
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </main>
            </div>

            <script>
                // Chart.js configurations
                document.addEventListener('DOMContentLoaded', function () {
                    // Enrollment Trends Chart
                    const enrollmentCtx = document.getElementById('enrollmentChart').getContext('2d');
                    new Chart(enrollmentCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Enrollments',
                                data: [12, 19, 15, 25, 22, 30],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                    // Popular Courses Chart
                    const popularCtx = document.getElementById('popularCoursesChart').getContext('2d');
                    new Chart(popularCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Full Stack', 'Python', 'Data Science', 'UI/UX', 'Mobile Dev'],
                            datasets: [{
                                label: 'Students Enrolled',
                                data: [10, 10, 5, 8, 6],
                                backgroundColor: [
                                    '#3b82f6',
                                    '#10b981',
                                    '#f59e0b',
                                    '#8b5cf6',
                                    '#06b6d4'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 12
                                }
                            }
                        }
                    });
                });

                // Page navigation functions
                function showAllCourses() {
                    document.getElementById('topCourses').classList.add('hidden');
                    document.getElementById('allCoursesTable').classList.remove('hidden');
                }
                //open preview
                function previewCourse(courseId) {
                    window.location.href = `/admin/courses/${courseId}/preview`;
                }


                function hideAllCourses() {
                    document.getElementById('topCourses').classList.remove('hidden');
                    document.getElementById('allCoursesTable').classList.add('hidden');
                }

                function showAddCoursePage() {
                    document.getElementById('courseManagementPage').classList.add('hidden');
                    document.getElementById('addCoursePage').classList.remove('hidden');
                    document.getElementById('editCoursePage').classList.add('hidden');
                }

                function cancelAddCourse() {
                    document.getElementById('addCoursePage').classList.add('hidden');
                    document.getElementById('courseManagementPage').classList.remove('hidden');
                    document.getElementById('editCoursePage').classList.add('hidden');
                }

                function openEditCourse(course) {
                    // Hide other pages
                    document.getElementById('courseManagementPage').classList.add('hidden');
                    document.getElementById('addCoursePage').classList.add('hidden');
                    document.getElementById('editCoursePage').classList.remove('hidden');

                    // Set form action
                    const form = document.getElementById('editCourseForm');
                    form.action = `/admin/courses/update/${course._id}`;
                    form.method = "POST";

                    // Populate fields
                    document.getElementById('editCourseName').value = course.title;
                    document.getElementById('editCourseFee').value = course.fee;
                    document.getElementById('editCourseDescription').value = course.fullDescription;
                    document.getElementById('editCourseEnrollments').value =
                        `${course.enrolledCount}/${course.intakeLimit}`;

                    document.getElementById('editCourseStatus').value = course.status;
                }

                function cancelEditCourse() {
                    document.getElementById('editCoursePage').classList.add('hidden');
                    document.getElementById('courseManagementPage').classList.remove('hidden');
                    document.getElementById('addCoursePage').classList.add('hidden');
                }
                // handle delete
                async function deleteCourse(courseId) {
                    const confirmDelete = confirm(
                        "Are you sure?\nThis will delete the course and ALL its lectures."
                    );

                    if (!confirmDelete) return;

                    try {
                        const res = await fetch(`/admin/courses/delete/${courseId}`, {
                            method: "DELETE",
                        });

                        const data = await res.json();

                        if (data.success) {
                            alert("Course deleted successfully");
                            location.reload();
                        } else {
                            alert("Failed to delete course");
                        }
                    } catch (error) {
                        console.error(error);
                        alert("Server error while deleting course");
                    }
                }


                //preserve origional DOM
                const originalRows = Array.from(
                    document.getElementById('courseTableBody').children
                );
                const tableBody = document.getElementById('courseTableBody');
                const allRows = Array.from(tableBody.children);


                function filterCourses() {
                    const searchValue = document.getElementById('courseSearch').value.toLowerCase();
                    const statusFilter = document.getElementById('statusFilter').value;
                    const sortFilter = document.getElementById('sortFilter').value;

                    let filteredRows = allRows.filter(row => {
                        const courseName = row.cells[0].textContent.toLowerCase();
                        const status = row.getAttribute('data-status')?.toLowerCase();

                        const matchesSearch = courseName.includes(searchValue);
                        const matchesStatus = statusFilter === 'all' || status === statusFilter;

                        return matchesSearch && matchesStatus;
                    });

                    filteredRows.sort((a, b) => {
                        const enrollmentsA = Number(a.getAttribute('data-enrollments'));
                        const enrollmentsB = Number(b.getAttribute('data-enrollments'));
                        const feeA = Number(a.getAttribute('data-fee'));
                        const feeB = Number(b.getAttribute('data-fee'));

                        switch (sortFilter) {
                            case 'trending':
                            case 'popular':
                                return enrollmentsB - enrollmentsA;
                            case 'price-low':
                                return feeA - feeB;
                            case 'price-high':
                                return feeB - feeA;
                            case 'recent':
                                return allRows.indexOf(a) - allRows.indexOf(b);
                            default:
                                return 0;
                        }
                    });

                    // Clear table and re-render
                    tableBody.innerHTML = '';
                    filteredRows.forEach(row => tableBody.appendChild(row));
                }

                // Toggle sidebar
                function toggleSidebar() {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar.style.display === 'none') {
                        sidebar.style.display = 'block';
                    } else {
                        sidebar.style.display = 'none';
                    }
                }

                // Toggle dropdown menus
                function toggleDropdown(menuId) {
                    const menu = document.getElementById(menuId);
                    menu.classList.toggle('hidden');
                }
                // add lectures
                function openLectureManager(courseId, courseTitle) {
                    window.location.href = `/admin/courses/${courseId}/lectures`;
                }


                // add category 
                function showAddCategoryPage() {
                    document.getElementById('courseManagementPage').classList.add('hidden');
                    document.getElementById('addCoursePage').classList.add('hidden');
                    document.getElementById('editCoursePage').classList.add('hidden');
                    document.getElementById('addCategoryPage').classList.remove('hidden');
                }

                function cancelAddCategory() {
                    document.getElementById('addCategoryPage').classList.add('hidden');
                    document.getElementById('courseManagementPage').classList.remove('hidden');
                }
                async function publishLecture(id) {
                    await fetch(`/api/course-content/publish/${id}`, {
                        method: "PATCH",
                    });
                    location.reload();
                }

                async function unpublishLecture(id) {
                    await fetch(`/api/course-content/unpublish/${id}`, {
                        method: "PATCH",
                    });
                    location.reload();
                }

                // Close dropdowns when clicking outside
                document.addEventListener('click', function (event) {
                    if (!event.target.closest('.relative')) {
                        document.querySelectorAll('#notifMenu, #adminMenu').forEach(menu => {
                            menu.classList.add('hidden');
                        });
                    }
                });
            </script>
    </body>

</html>