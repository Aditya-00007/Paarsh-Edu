<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>EduPlatform Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-[#f4f6f9]">

  <%- include('../partials/header.ejs') %>

    <div class="flex">
      <%- include('../partials/sidebar.ejs') %>
        <!-- DASHBOARD CONTENT -->
        <main class="flex-1 p-6 space-y-6" id="dashboardPage">
          <!-- Page Header -->
          <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-800">
              Dashboard
            </h1>
            <p class="text-sm text-gray-700 mt-1">
              Summary of all your work
            </p>
          </div>
          <!-- STATS  -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-xl shadow-sm p-4">
              <h6 class="text-gray-600 text-sm">Total Courses</h6>
              <div class="text-3xl font-bold mt-2">
                <%= courses.length %>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-4">
              <h6 class="text-gray-600 text-sm">Total Students</h6>
              <div class="text-3xl font-bold mt-2">
                <%= totalStudents %>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-4">
              <h6 class="text-gray-600 text-sm">Enrollments</h6>
              <div class="text-3xl font-bold mt-2">
                <%= totalEnrollments %>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-4">
              <h6 class="text-gray-600 text-sm">Enquiries</h6>
              <div class="text-3xl font-bold mt-2">
                <%= totalEnquirires %>
              </div>
            </div>
          </div>

          <!-- QUICK ACTION BUTTONS  -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 hidden">
            <button class="w-full py-3 rounded-lg bg-blue-600 text-white font-semibold hover:opacity-90"
              onclick="showAddCoursePage()">
              Add New Course
            </button>


            <button
              class="w-full py-3 rounded-lg border border-blue-600 text-blue-600 font-semibold hover:bg-blue-600 hover:text-white transition">
              View Students
            </button>

            <button
              class="w-full py-3 rounded-lg border border-green-600 text-green-600 font-semibold hover:bg-green-600 hover:text-white transition">
              View Payments
            </button>

            <button
              class="w-full py-3 rounded-lg border border-gray-900 text-gray-900 font-semibold hover:bg-gray-900 hover:text-white transition">
              View Teachers
            </button>

            <button
              class="w-full py-3 rounded-lg border border-gray-500 text-gray-600 font-semibold hover:bg-gray-600 hover:text-white transition">
              Manage Enrollments
            </button>
          </div>

          <!-- GRAPH + SUMMARY  -->
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">

            <!-- Today’s Summary -->
            <div class="lg:col-span-4 bg-white rounded-xl shadow-sm p-4">
  <h5 class="font-semibold text-lg">Today’s Summary</h5>

  <ul class="mt-3 space-y-2 text-sm">
    <li class="flex justify-between border-b pb-2">
      <span>New Students</span>
      <b><%= todayStudents %></b>
    </li>

    <li class="flex justify-between border-b pb-2">
      <span>New Enrollments</span>
      <b><%= todayEnrollments %></b>
    </li>

    <li class="flex justify-between border-b pb-2">
      <span>Today’s New Courses</span>
      <b><%= todayCourses %></b>
    </li>

    <li class="flex justify-between border-b pb-2">
      <span>Placement Eligible Students</span>
      <b><%= placementEligibleStudents %></b>
    </li>

    <li class="flex justify-between">
      <span>New Blogs</span>
      <b><%= todayBlogs %></b>
    </li>
  </ul>
</div>


            <!-- Enquiries Summary -->
            <div class="lg:col-span-8 bg-white rounded-xl shadow-sm p-4 overflow-x-auto">
              <h5 class="font-semibold text-lg mb-3">Enquiries Summary</h5>

              <table class="w-full text-sm">
                <thead class="text-gray-600 border-b">
                  <tr>
                    <th class="text-left py-2">Name</th>
                    <th class="text-left py-2">Course Interested</th>
                    <th class="text-left py-2">Status</th>
                    <th class="text-left py-2">Action</th>
                  </tr>
                </thead>

                <tbody>
  <% if (enquiries.length === 0) { %>
    <tr>
      <td colspan="4" class="py-4 text-center text-gray-500">
        No enquiries found
      </td>
    </tr>
  <% } %>

  <% enquiries.forEach(enquiry => { %>
    <tr class="border-b">
      <!-- Name -->
      <td class="py-3"><%= enquiry.name %></td>

      <!-- Course -->
      <td class="py-3">
        <%= enquiry.courseName || "General Enquiry" %>
      </td>

      <!-- Status -->
      <td class="py-3">
        <% 
          let statusClass = "";
          let statusText = "";

          if (enquiry.status === "new") {
            statusClass = "bg-blue-100 text-blue-700";
            statusText = "New";
          } else if (enquiry.status === "contacted") {
            statusClass = "bg-yellow-100 text-yellow-700";
            statusText = "Contacted";
          } else if (enquiry.status === "enrolled") {
            statusClass = "bg-green-100 text-green-700";
            statusText = "Enrolled";
          } else {
            statusClass = "bg-gray-100 text-gray-700";
            statusText = "Closed";
          }
        %>

        <span class="px-3 py-1 rounded-full text-xs font-semibold <%= statusClass %>">
          <%= statusText %>
        </span>
      </td>

      <!-- Action -->
      <td class="py-3">
        <a href="/enquiries/<%= enquiry._id %>"
           class="px-3 py-1 rounded-md border border-blue-600 text-blue-600 text-xs hover:bg-blue-600 hover:text-white transition">
          View
        </a>
      </td>
    </tr>
  <% }) %>
</tbody>

              </table>
            </div>

          </div>


          <!-- TABLES  -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

            <div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto">
              <h5 class="font-semibold text-lg mb-3">Recent Enrollments</h5>
              <table class="w-full text-sm">
                <thead class="text-gray-600 border-b">
                  <tr>
                    <th class="text-left py-2">Student</th>
                    <th class="text-left py-2">Course</th>
                    <th class="text-left py-2">Status</th>
                    <th class="text-left py-2">Action</th>
                  </tr>
                </thead>
                <tbody>
  <% if (enrollments.length === 0) { %>
    <tr>
      <td colspan="4" class="py-4 text-center text-gray-500">
        No enrollments found
      </td>
    </tr>
  <% } %>

  <% enrollments.slice(0, 3).forEach(enrollment => { %>
    <tr class="border-b">
      
      <!-- Student Name -->
      <td class="py-3">
        <%= enrollment.student.name %>
      </td>

      <!-- Course Name -->
      <td class="py-3">
        <%= enrollment.course.title %>
      </td>

      <!-- Enrollment Date -->
      <td class="py-3 text-sm text-gray-600">
        <%= new Date(enrollment.enrolledAt).toLocaleDateString("en-IN") %>
      </td>

      <!-- Action -->
      <td class="py-3">
        <a href="/student-management/enrollment/<%= enrollment._id %>/view"
           class="px-3 py-1 rounded-md border border-blue-600 text-blue-600 text-xs hover:bg-blue-600 hover:text-white transition">
          View
        </a>
      </td>
    </tr>
  <% }) %>
</tbody>


              </table>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto">
              <h5 class="font-semibold text-lg mb-3">New Courses</h5>

              <table class="w-full text-sm">
                <thead class="text-gray-600 border-b">
                  <tr>
                    <th class="text-left py-2">Course</th>
                    <th class="text-left py-2">Teacher</th>
                    <th class="text-left py-2">Date</th>
                    <th class="text-left py-2">Action</th>
                  </tr>
                </thead>

                <tbody>
                  <% courses .sort((a, b)=> new Date(b.createdAt) - new Date(a.createdAt))
                    .slice(0, 3)
                    .forEach(course => {
                    %>
                    <tr class="border-b last:border-b-0">
                      <!-- Course Title -->
                      <td class="py-3 font-medium">
                        <%= course.title %>
                      </td>

                      <!-- Instructor -->
                      <td class="py-3 text-gray-600">
                        <%= course.instructor?.name || 'Not Assigned' %>
                      </td>

                      <!-- Created Date -->
                      <td class="py-3 text-gray-500">
                        <%= new Date(course.createdAt).toLocaleDateString('en-IN', { day: '2-digit' , month: 'short' ,
                          year: 'numeric' }) %>
                      </td>

                      <!-- Action -->
                      <td class="py-3">
                        <a href="/admin-course/courses/<%= course._id %>/preview" class="px-3 py-1 rounded-md border border-blue-600 text-blue-600 text-xs
                      hover:bg-blue-600 hover:text-white transition">
                          View
                        </a>
                      </td>
                    </tr>
                    <% }) %>

                      <% if (courses.length===0) { %>
                        <tr>
                          <td colspan="4" class="text-center py-4 text-gray-400">
                            No courses found
                          </td>
                        </tr>
                        <% } %>
                </tbody>
              </table>
            </div>

          </div>

        </main>
        <%- include('../partials/add-course.ejs') %>
    </div>

    <script>
      let isOpen = true;
      function toggleSidebar() {
        isOpen = !isOpen;
        const sidebar = document.getElementById("sidebar");
        sidebar.style.width = isOpen ? "260px" : "0px";
        sidebar.style.padding = isOpen ? "16px" : "0px";
        sidebar.style.overflow = isOpen ? "visible" : "hidden";
      }

      function toggleDropdown(id) {
        const el = document.getElementById(id);
        el.classList.toggle("hidden");
      }



      function showAddCoursePage() {
        document.getElementById('dashboardPage')?.classList.add('hidden');
        document.getElementById('addCoursePage').classList.remove('hidden');
      }

      function cancelAddCourse() {
        document.getElementById('addCoursePage').classList.add('hidden');
        document.getElementById('dashboardPage')?.classList.remove('hidden');
      }

    </script>

</body>

</html>