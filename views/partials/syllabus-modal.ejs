<div
  id="syllabusModal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
>
  <div class="bg-white w-[90vw] h-[85vh] rounded-lg shadow-lg flex flex-col">

    <!-- Header -->
    <div class="px-6 py-4 border-b flex justify-between items-center">
      <h2 class="text-xl font-semibold">Syllabus Builder</h2>
      <button onclick="closeSyllabusModal()" class="text-2xl text-gray-500">&times;</button>
    </div>

    <!-- Body -->
    <div class="flex-1 overflow-auto p-6">
      <form method="POST" action="/admin/syllabus/add" id="syllabusForm">

        <!-- Course ID (set from edit course) -->
        <input type="hidden" name="course" id="syllabusCourseId" />

        <!-- Modules container -->
        <div id="modulesContainer" class="space-y-4"></div>

        <button
          type="button"
          onclick="addModule()"
          class="mt-4 px-4 py-2 bg-blue-600 text-white rounded"
        >
          ➕ Add Module
        </button>
      </form>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t flex justify-end gap-3">
      <button
        type="button"
        onclick="closeSyllabusModal()"
        class="px-6 py-2 border rounded"
      >
        Cancel
      </button>
      <button
        type="submit"
        form="syllabusForm"
        class="px-6 py-2 bg-green-600 text-white rounded"
      >
        Save Syllabus
      </button>
    </div>

  </div>
</div>
<script>
  let moduleIndex = 0;
  let activeModuleIndex = null;

  function openSyllabusModal() {
    document.getElementById("syllabusModal").classList.remove("hidden");
  }

  function closeSyllabusModal() {
    document.getElementById("syllabusModal").classList.add("hidden");
  }

  function addModule() {
    const container = document.getElementById("modulesContainer");

    // collapse current module
    if (activeModuleIndex !== null) {
      const prev = document.getElementById(`module-body-${activeModuleIndex}`);
      if (prev) prev.classList.add("hidden");
    }

    const currentIndex = moduleIndex;
    activeModuleIndex = currentIndex;

    const moduleDiv = document.createElement("div");
    moduleDiv.className = "border rounded";

    moduleDiv.innerHTML = `
      <!-- Module Header -->
      <div
        onclick="openModule(${currentIndex})"
        class="flex justify-between items-center px-4 py-3 bg-gray-100 cursor-pointer"
      >
        <input
          type="text"
          name="modules[${currentIndex}][moduleTitle]"
          placeholder="Module title"
          class="bg-transparent font-semibold outline-none w-1/2"
          required
        />

        <input
          type="number"
          name="modules[${currentIndex}][moduleOrder]"
          value="${currentIndex + 1}"
          class="w-20 border px-2 py-1 rounded"
        />
      </div>

      <!-- Module Body -->
      <div id="module-body-${currentIndex}" class="p-4">
        <div id="items-${currentIndex}" class="space-y-3"></div>

        <button
          type="button"
          onclick="addItem(${currentIndex})"
          class="mt-2 text-blue-600 text-sm"
        >
          ➕ Add Topic / Assignment / Test
        </button>
      </div>
    `;

    container.appendChild(moduleDiv);
    moduleIndex++;
  }

  function openModule(index) {
    document.querySelectorAll("[id^='module-body-']").forEach(el => {
      el.classList.add("hidden");
    });

    const body = document.getElementById(`module-body-${index}`);
    if (body) body.classList.remove("hidden");

    activeModuleIndex = index;
  }

  function addItem(moduleIdx) {
    if (activeModuleIndex !== moduleIdx) return;

    const container = document.getElementById(`items-${moduleIdx}`);
    const itemIndex = container.children.length;

    const div = document.createElement("div");
    div.className = "grid grid-cols-4 gap-3 border p-3 rounded";

    div.innerHTML = `
      <select
        name="modules[${moduleIdx}][items][${itemIndex}][itemType]"
        class="border px-2 py-1 rounded"
      >
        <option value="topic">Topic</option>
        <option value="assignment">Assignment</option>
        <option value="test">Test</option>
      </select>

      <input
        type="text"
        name="modules[${moduleIdx}][items][${itemIndex}][title]"
        placeholder="Title"
        class="border px-2 py-1 rounded col-span-2"
        required
      />

      <input
        type="number"
        name="modules[${moduleIdx}][items][${itemIndex}][order]"
        value="${itemIndex + 1}"
        class="border px-2 py-1 rounded"
        required
      />
    `;

    container.appendChild(div);
  }
</script>
